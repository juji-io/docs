<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>juji.func.system documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Juji Built-in Functions</span> <span class="project-version">2.1.35</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1"><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><a href="juji.func.data.html"><div class="inner"><span>juji.func.data</span></div></a></li><li class="depth-1"><a href="juji.func.nlp.html"><div class="inner"><span>juji.func.nlp</span></div></a></li><li class="depth-1 current"><a href="juji.func.system.html"><div class="inner"><span>juji.func.system</span></div></a></li><li class="depth-1"><a href="juji.func.user.html"><div class="inner"><span>juji.func.user</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="juji.func.system.html#var--.3C-"><div class="inner"><span>-&lt;-</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var--.3C-.7C"><div class="inner"><span>-&lt;-|</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-.3C-"><div class="inner"><span>&lt;-</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-.3C-.7C"><div class="inner"><span>&lt;-|</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-.3E-"><div class="inner"><span>&gt;-</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-add-background"><div class="inner"><span>add-background</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-add-background-once"><div class="inner"><span>add-background-once</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-add-input-translation"><div class="inner"><span>add-input-translation</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-answer-text"><div class="inner"><span>answer-text</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-answer-value"><div class="inner"><span>answer-value</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-ask-for-more.3F"><div class="inner"><span>ask-for-more?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-ask-question"><div class="inner"><span>ask-question</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-ask-question-gui"><div class="inner"><span>ask-question-gui</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-capture-double"><div class="inner"><span>capture-double</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-capture-identifier"><div class="inner"><span>capture-identifier</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-capture-integer"><div class="inner"><span>capture-integer</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-capture-string"><div class="inner"><span>capture-string</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-capture-string-lemmatized"><div class="inner"><span>capture-string-lemmatized</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-capture-string-raw"><div class="inner"><span>capture-string-raw</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-cleanup-chat"><div class="inner"><span>cleanup-chat</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-concat-tokens"><div class="inner"><span>concat-tokens</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-create-new-participation-question-map"><div class="inner"><span>create-new-participation-question-map</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-current-chat-progress"><div class="inner"><span>current-chat-progress</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-current-topic-fired.3F"><div class="inner"><span>current-topic-fired?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-day-of-week"><div class="inner"><span>day-of-week</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-end-chat"><div class="inner"><span>end-chat</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-end-interview"><div class="inner"><span>end-interview</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-exp"><div class="inner"><span>exp</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-first-agenda-topic"><div class="inner"><span>first-agenda-topic</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-float-div"><div class="inner"><span>float-div</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-force-chatbot-continue"><div class="inner"><span>force-chatbot-continue</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-ask-for-more-count"><div class="inner"><span>get-ask-for-more-count</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-current-question"><div class="inner"><span>get-current-question</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-date-by-offset"><div class="inner"><span>get-date-by-offset</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-fb-media-gui-titles"><div class="inner"><span>get-fb-media-gui-titles</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-last-participation-question-map"><div class="inner"><span>get-last-participation-question-map</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-next-question"><div class="inner"><span>get-next-question</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-nth-last-asked-agenda-question"><div class="inner"><span>get-nth-last-asked-agenda-question</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-participation-question-attr"><div class="inner"><span>get-participation-question-attr</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-question-heading"><div class="inner"><span>get-question-heading</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-task-completion-code"><div class="inner"><span>get-task-completion-code</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-get-web-media-gui-titles"><div class="inner"><span>get-web-media-gui-titles</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-has-participation.3F"><div class="inner"><span>has-participation?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-input-text-match-choice"><div class="inner"><span>input-text-match-choice</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-is-gui-question"><div class="inner"><span>is-gui-question</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-jump-to-topic"><div class="inner"><span>jump-to-topic</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-make-choice-horizontal"><div class="inner"><span>make-choice-horizontal</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-make-open-ended-question"><div class="inner"><span>make-open-ended-question</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-make-request"><div class="inner"><span>make-request</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-make-single-choice-question"><div class="inner"><span>make-single-choice-question</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-match"><div class="inner"><span>match</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-match-stashed"><div class="inner"><span>match-stashed</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-multiple-choice-answer-values"><div class="inner"><span>multiple-choice-answer-values</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-outbound-redirect-url"><div class="inner"><span>outbound-redirect-url</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-parse-number"><div class="inner"><span>parse-number</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-post-chat-url"><div class="inner"><span>post-chat-url</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-pow"><div class="inner"><span>pow</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-question-answered.3F"><div class="inner"><span>question-answered?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-question-asked.3F"><div class="inner"><span>question-asked?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-question-has-paraphrase.3F"><div class="inner"><span>question-has-paraphrase?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-question-response-failed.3F"><div class="inner"><span>question-response-failed?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-random-code"><div class="inner"><span>random-code</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-random-number-string"><div class="inner"><span>random-number-string</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-record-one-move-message"><div class="inner"><span>record-one-move-message</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-remaining-agenda-question-count"><div class="inner"><span>remaining-agenda-question-count</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-remaining-agenda-size"><div class="inner"><span>remaining-agenda-size</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-required.3F"><div class="inner"><span>required?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-reset-followup-conditions"><div class="inner"><span>reset-followup-conditions</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-return-to-question"><div class="inner"><span>return-to-question</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-set-question-min-input-len"><div class="inner"><span>set-question-min-input-len</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-set-question-response-failed"><div class="inner"><span>set-question-response-failed</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-set-timer"><div class="inner"><span>set-timer</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-skip-all-subtopics"><div class="inner"><span>skip-all-subtopics</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-skip-next-subtopic"><div class="inner"><span>skip-next-subtopic</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-sleep-rep"><div class="inner"><span>sleep-rep</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-stash-input"><div class="inner"><span>stash-input</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-thin-text.3F"><div class="inner"><span>thin-text?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-timer-expired.3F"><div class="inner"><span>timer-expired?</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-update-ask-for-more-counter"><div class="inner"><span>update-ask-for-more-counter</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-update-last-participation-question-map"><div class="inner"><span>update-last-participation-question-map</span></div></a></li><li class="depth-1"><a href="juji.func.system.html#var-wait-for-more-user-input"><div class="inner"><span>wait-for-more-user-input</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">juji.func.system</h1><div class="doc"><div class="markdown"><p>System related built-in functions</p></div></div><div class="public anchor" id="var--.3C-"><h3>-&lt;-</h3><div class="usage"><code>(-&lt;- rep sym value)</code></div><div class="doc"><div class="markdown"><p>Assign value to a topic specific variable <code>sym</code> and return the value.</p>
<p>This is the same as <code>-&lt;-|</code> except this variable only exists in the scope of the current topic and its followup-topics.</p></div></div></div><div class="public anchor" id="var--.3C-.7C"><h3>-&lt;-|</h3><div class="usage"><code>(-&lt;-| rep sym value)</code></div><div class="doc"><div class="markdown"><p>Assign value to a global variable <code>sym</code> and return the value.</p>
<p><strong>Example</strong></p>
<pre><code>;; The pattern below assigns value 5 to variable `?a`
;; If the pattern is used as trigger,
;; it will also trigger the corresponding action in the rule
[(-&lt;-| ?a (+ 2 3))]

;; later, anywhere in the chat, the following pattern
;; is able to retrieve the value stored in `?a`
[(&gt;- ?a)]
</code></pre></div></div></div><div class="public anchor" id="var-.3C-"><h3>&lt;-</h3><div class="usage"><code>(&lt;- rep sym value)</code></div><div class="doc"><div class="markdown"><p>Assign value to a topic specific variable <code>sym</code> and return <code>nil</code>.</p>
<p>This is the same as -&lt;- except it returns <code>nil</code>.</p></div></div></div><div class="public anchor" id="var-.3C-.7C"><h3>&lt;-|</h3><div class="usage"><code>(&lt;-| rep sym value)</code></div><div class="doc"><div class="markdown"><p>Assign value to a global variable <code>sym</code> and return <code>nil</code>.</p>
<p>This is the same as -&lt;-| except it returns <code>nil</code>.</p></div></div></div><div class="public anchor" id="var-.3E-"><h3>&gt;-</h3><div class="usage"><code>(&gt;- rep sym)</code></div><div class="doc"><div class="markdown"><p>Return value assigned to variable <code>sym</code>.</p></div></div></div><div class="public anchor" id="var-add-background"><h3>add-background</h3><div class="usage"><code>(add-background rep topic-invocation)</code></div><div class="doc"><div class="markdown"><p>Add a topic invocation to the background topics that runs periodically and does not remove itself after firing. Return nil.</p></div></div></div><div class="public anchor" id="var-add-background-once"><h3>add-background-once</h3><div class="usage"><code>(add-background-once rep topic-invocation)</code></div><div class="doc"><div class="markdown"><p>Append a topic invocation to the background topics that runs periodically, but removes itself once fired. Return nil</p></div></div></div><div class="public anchor" id="var-add-input-translation"><h3>add-input-translation</h3><div class="usage"><code>(add-input-translation rep translation)</code></div><div class="doc"><div class="markdown"><p>Add the given text as the translation of the current user input. The added translations will be used in the subsequent matches in conjunction with the original user input. The translations have precedence over the original input during matching, and are tried in the order they are added. Once added, the translation has the same life cycle as the original user input. </p></div></div></div><div class="public anchor" id="var-answer-text"><h3>answer-text</h3><div class="usage"><code>(answer-text rep qn)</code></div><div class="doc"><div class="markdown"><p>Retrieve the answer text for question <code>qn</code> the last time it was asked.</p>
<p>For the current question in the conversation, its answer text may differ from the current user input because an answer text may be the concatenation of multiple rounds of user input.</p></div></div></div><div class="public anchor" id="var-answer-value"><h3>answer-value</h3><div class="usage"><code>(answer-value rep qn)</code></div><div class="doc"><div class="markdown"><p>Retrieve the answer value of question <code>qn</code> the last time it was asked. Answer value is specific to choice questions.</p></div></div></div><div class="public anchor" id="var-ask-for-more.3F"><h3>ask-for-more?</h3><div class="usage"><code>(ask-for-more? rep question)</code><code>(ask-for-more? rep question threshold)</code></div><div class="doc"><div class="markdown"><p>Return true if the input is short and the number of times the chatbot asked for more has not yet reach the <code>threshold</code>. <code>threshold</code> is 1 if not provided. Usually used together with <code>update-ask-for-more-counter</code></p></div></div></div><div class="public anchor" id="var-ask-question"><h3>ask-question</h3><div class="usage"><code>(ask-question rep qn)</code><code>(ask-question rep qn wording)</code><code>(ask-question rep qn wording mode)</code><code>(ask-question rep qn wording mode question-tag)</code></div><div class="doc"><div class="markdown"><p>Ask an open-ended question <code>qn</code>.</p>
<p>If <code>wording</code> (a string) is given, use it as the actual question wording; otherwise use the wording or heading from the defined question <code>qn</code>.</p>
<p><code>mode</code> can be <code>:first-time</code> or <code>:repeating</code>. <code>mode</code> also affects question message when <code>wording</code> is <code>nil</code>:</p>
<ul>
  <li>if <code>:first-time</code>, wording of <code>qn</code> is used if available;</li>
  <li>if :repeating, heading of of <code>qn</code> is used.</li>
</ul>
<p><code>qn</code> is one of the question variables defined in script. See <a href="https://juji.io/docs/reference/#question">https://juji.io/docs/reference/#question</a> for detailed explaination on defining questions.</p></div></div></div><div class="public anchor" id="var-ask-question-gui"><h3>ask-question-gui</h3><div class="usage"><code>(ask-question-gui rep qn)</code><code>(ask-question-gui rep qn {:keys [question-tag mode], :as option-map})</code></div><div class="doc"><div class="markdown"><p>Ask question <code>qn</code> in GUI form. GUI form is usually used for asking single choice and multiple choice questions.</p>
<p><code>qn</code> is one of the question variables defined in script. See <a href="https://juji.io/docs/reference/#question">https://juji.io/docs/reference/#question</a> for detailed explaination on defining questions.</p>
<p><code>mode</code> can be <code>:first-time</code> or <code>:repeating</code>.</p></div></div></div><div class="public anchor" id="var-capture-double"><h3>capture-double</h3><div class="usage"><code>(capture-double _ i d f)</code></div><div class="doc"><div class="markdown"><p>Convert the captured content to a double, the capture pattern is assumed to be <code>[[:? #token/regex "\d+"] "." #token/regex "\d+"]</code></p></div></div></div><div class="public anchor" id="var-capture-identifier"><h3>capture-identifier</h3><div class="usage"><code>(capture-identifier _ &amp; ss)</code></div><div class="doc"><div class="markdown"><p>Get the identifier from the captured content</p></div></div></div><div class="public anchor" id="var-capture-integer"><h3>capture-integer</h3><div class="usage"><code>(capture-integer _ &amp; [i])</code></div><div class="doc"><div class="markdown"><p>Convert the captured content to an integer, the capture pattern is assumed to be <code>[#token/regex "\d+"]</code></p></div></div></div><div class="public anchor" id="var-capture-string"><h3>capture-string</h3><div class="usage"><code>(capture-string _ &amp; ss)</code></div><div class="doc"><div class="markdown"><p>Get the string from the captured content, lower case them and interposing them with spaces</p></div></div></div><div class="public anchor" id="var-capture-string-lemmatized"><h3>capture-string-lemmatized</h3><div class="usage"><code>(capture-string-lemmatized _ &amp; ss)</code></div><div class="doc"><div class="markdown"><p>Get the string from the captured content, lower case them and interposing them with spaces</p></div></div></div><div class="public anchor" id="var-capture-string-raw"><h3>capture-string-raw</h3><div class="usage"><code>(capture-string-raw _ &amp; ss)</code></div><div class="doc"><div class="markdown"><p>Get the string from the captured content, just concatenating the content without any changes</p></div></div></div><div class="public anchor" id="var-cleanup-chat"><h3>cleanup-chat</h3><div class="usage"><code>(cleanup-chat rep)</code></div><div class="doc"><div class="markdown"><p>Clean up the server resource for this participation. This leaves the participation unfinished if <code>(end-chat)</code> has not been called. Refresh or reconnect leads to a new participation.</p></div></div></div><div class="public anchor" id="var-concat-tokens"><h3>concat-tokens</h3><div class="usage"><code>(concat-tokens _ &amp; tokens)</code></div><div class="doc"><div class="markdown"><p>Concatenate the tokens into a single string. Often used as a normalization function for the captured content. <strong>Example Use</strong></p>
<pre><code>;; the following rule show the captured confirmation code
[my confirmation code is (?x [:s #token/regex "[a-z]+"
            #token/regex "[A-Z]+"
            #token/regex "[0-9]+"]
            concat-tokens)]
[?x]
;; input: my confirmation code is XYZ13NBC3
;; output: XYZ13NBC3
</code></pre></div></div></div><div class="public anchor" id="var-create-new-participation-question-map"><h3>create-new-participation-question-map</h3><div class="usage"><code>(create-new-participation-question-map rep question)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-current-chat-progress"><h3>current-chat-progress</h3><div class="usage"><code>(current-chat-progress rep)</code></div><div class="doc"><div class="markdown"><p>Show a precentage of completed agenda topics. Return a float between 0 and 1.0.</p></div></div></div><div class="public anchor" id="var-current-topic-fired.3F"><h3>current-topic-fired?</h3><div class="usage"><code>(current-topic-fired? rep)</code></div><div class="doc"><div class="markdown"><p>Return true if the current topic generates a response.</p></div></div></div><div class="public anchor" id="var-day-of-week"><h3>day-of-week</h3><div class="usage"><code>(day-of-week _)</code></div><div class="doc"><div class="markdown"><p>Present the day of the week of current UTC time.</p></div></div></div><div class="public anchor" id="var-end-chat"><h3>end-chat</h3><div class="usage"><code>(end-chat rep)</code><code>(end-chat rep redirect-url)</code></div><div class="doc"><div class="markdown"><p>Finish the current participation and redirect to the specified page if <code>redirect-url</code> is provided. <code>redirect-url</code> is a string.</p></div></div></div><div class="public anchor" id="var-end-interview"><h3>end-interview</h3><h4 class="deprecated">deprecated</h4><div class="usage"><code>(end-interview rep)</code></div><div class="doc"><div class="markdown"><p>End the current interview and redirect to the post-chat page after short delay.</p>
<p>This function is deprecated, please use <code>end-chat</code> instead.</p></div></div></div><div class="public anchor" id="var-exp"><h3>exp</h3><div class="usage"><code>(exp exponent)</code></div><div class="doc"><div class="markdown"><p>Natural exponential function.</p></div></div></div><div class="public anchor" id="var-first-agenda-topic"><h3>first-agenda-topic</h3><div class="usage"><code>(first-agenda-topic rep)</code></div><div class="doc"><div class="markdown"><p>Return the first agenda topic.</p></div></div></div><div class="public anchor" id="var-float-div"><h3>float-div</h3><div class="usage"><code>(float-div a b)</code></div><div class="doc"><div class="markdown"><p>Return division results in decimal</p></div></div></div><div class="public anchor" id="var-force-chatbot-continue"><h3>force-chatbot-continue</h3><div class="usage"><code>(force-chatbot-continue rep)</code></div><div class="doc"><div class="markdown"><p>Force the chatbot continue into the next topic without waiting for user input. This maybe useful to ask questions in a subtopic or making the background to terminate the current agenda topic.</p></div></div></div><div class="public anchor" id="var-get-ask-for-more-count"><h3>get-ask-for-more-count</h3><div class="usage"><code>(get-ask-for-more-count rep question)</code></div><div class="doc"><div class="markdown"><p>Count how many times the chatbot asked for more info regarding the given question.</p></div></div></div><div class="public anchor" id="var-get-current-question"><h3>get-current-question</h3><div class="usage"><code>(get-current-question rep)</code></div><div class="doc"><div class="markdown"><p>Get the current question base on what on top of the stack. Assume the first question type argument is question.</p></div></div></div><div class="public anchor" id="var-get-date-by-offset"><h3>get-date-by-offset</h3><div class="usage"><code>(get-date-by-offset _ offset)</code></div><div class="doc"><div class="markdown"><p>Return a clojure instant in UTC after applying the offset.</p></div></div></div><div class="public anchor" id="var-get-fb-media-gui-titles"><h3>get-fb-media-gui-titles</h3><div class="usage"><code>(get-fb-media-gui-titles _ gui-map)</code></div><div class="doc"><div class="markdown"><p>Get the title of the given facebook media gui.</p></div></div></div><div class="public anchor" id="var-get-last-participation-question-map"><h3>get-last-participation-question-map</h3><div class="usage"><code>(get-last-participation-question-map rep question)</code></div><div class="doc"><div class="markdown"><p>Return the participation question map of the given <code>question</code>. For question related information intended to be persisted throughout the participation, participation question map is the right place to store. One can use <code>update-last-participation-question-map</code> to update.</p></div></div></div><div class="public anchor" id="var-get-next-question"><h3>get-next-question</h3><div class="usage"><code>(get-next-question rep)</code></div><div class="doc"><div class="markdown"><p>Get the next question in agenda. Return nil if none exist. Ignore remarks.</p></div></div></div><div class="public anchor" id="var-get-nth-last-asked-agenda-question"><h3>get-nth-last-asked-agenda-question</h3><div class="usage"><code>(get-nth-last-asked-agenda-question rep n)</code></div><div class="doc"><div class="markdown"><p>Return the REP’s nth last asked agenda question in the form of a map, return nil if it does not exist. when n is 0, the latest asked question is returned, 1 is the one before …</p></div></div></div><div class="public anchor" id="var-get-participation-question-attr"><h3>get-participation-question-attr</h3><div class="usage"><code>(get-participation-question-attr rep question attr)</code></div><div class="doc"><div class="markdown"><p>Return the value of <code>attr</code> field in the given <code>question</code>’s participation question map.</p></div></div></div><div class="public anchor" id="var-get-question-heading"><h3>get-question-heading</h3><div class="usage"><code>(get-question-heading _ question)</code></div><div class="doc"><div class="markdown"><p>Question heading is used as unique identifier of a question,it should rarely be changed. This function should not be used for asking question, <code>ask-question</code> is the preferred function to do that.</p></div></div></div><div class="public anchor" id="var-get-task-completion-code"><h3>get-task-completion-code</h3><div class="usage"><code>(get-task-completion-code rep)</code></div><div class="doc"><div class="markdown"><p>Get the task completion code of the current participation. If the code does not exist, it will be generated and then returned.</p></div></div></div><div class="public anchor" id="var-get-web-media-gui-titles"><h3>get-web-media-gui-titles</h3><div class="usage"><code>(get-web-media-gui-titles _ gui-map)</code></div><div class="doc"><div class="markdown"><p>Get the title of the given web media gui.</p></div></div></div><div class="public anchor" id="var-has-participation.3F"><h3>has-participation?</h3><div class="usage"><code>(has-participation? rep)</code></div><div class="doc"><div class="markdown"></div></div></div><div class="public anchor" id="var-input-text-match-choice"><h3>input-text-match-choice</h3><div class="usage"><code>(input-text-match-choice rep qn)</code></div><div class="doc"><div class="markdown"><p>Check if the input text matches at least one of the choice in the question. Return a move message (a map) if it matches; return nil otherwise.</p></div></div></div><div class="public anchor" id="var-is-gui-question"><h3>is-gui-question</h3><div class="usage"><code>(is-gui-question rep qn)</code></div><div class="doc"><div class="markdown"><p>Check if <code>qn</code> is a GUI form friendly question (e.g., single choice, multiple choice question)</p>
<p><code>qn</code> is one of the question variables defined in script. See <a href="https://juji.io/docs/reference/#question">https://juji.io/docs/reference/#question</a> for detailed explaination on defining questions.</p></div></div></div><div class="public anchor" id="var-jump-to-topic"><h3>jump-to-topic</h3><div class="usage"><code>(jump-to-topic rep topic)</code></div><div class="doc"><div class="markdown"><p>Return to the first appearance of the given topic in agenda. The function is called with topic-name. However, the topic-name will get resovled to topic-map by the REP engine.</p></div></div></div><div class="public anchor" id="var-make-choice-horizontal"><h3>make-choice-horizontal</h3><div class="usage"><code>(make-choice-horizontal _ q-map)</code></div><div class="doc"><div class="markdown"><p>Make the choice question’s option horizontally displayed on web.</p></div></div></div><div class="public anchor" id="var-make-open-ended-question"><h3>make-open-ended-question</h3><div class="usage"><code>(make-open-ended-question rep heading)</code><code>(make-open-ended-question rep heading wording)</code><code>(make-open-ended-question rep heading wording required?)</code><code>(make-open-ended-question rep heading wording required? qid)</code></div><div class="doc"><div class="markdown"><p>This is a wrapper to create an question map that can be passed into <code>ask-question</code> and <code>record-answer</code> function. <code>heading</code>, <code>wording</code> and <code>qid</code> are strings. <code>required?</code> is a boolean.</p>
<p><code>:required</code> has default value <code>true</code> if not specified. <code>wording</code> has defualt value to be the same as <code>heading</code>, if <code>wording</code> is not specified or is <code>nil</code>. We recommend users not to specify <code>qid</code>, the system will generate a unique <code>qid</code> and it can be accessed in the returned question map. Please only specify it if you know what you are doing, and make sure the assigned <code>qid</code> is unique in the entire release.</p></div></div></div><div class="public anchor" id="var-make-request"><h3>make-request</h3><div class="usage"><code>(make-request rep base-url)</code><code>(make-request rep base-url query-map)</code><code>(make-request _ base-url query-map socket-timeout)</code></div><div class="doc"><div class="markdown"><p>Make request to given url composed by <code>base-url</code> and querys in <code>query-map</code>. Return the body of the request results. Return nil if the request is not successful.</p>
<p>The keys of <code>query-map</code> (if exists and not nil) are argument names, values are the corresponding argument values. The keys and values will be url-encoded when forming the request url (e.g., “a b” becomes “a%20b”).</p>
<p><code>socket-timeout</code> default to 10000, it is in milliseconds</p>
<pre><code>[(make-request "http://sampleweb.com:1234/abc/def" {:k1 "10", :k2 "20"})]
;; the pattern above would make a request to "http://sampleweb.com:1234/abc/def?k1=10&amp;k2=20" and return the request result
</code></pre></div></div></div><div class="public anchor" id="var-make-single-choice-question"><h3>make-single-choice-question</h3><div class="usage"><code>(make-single-choice-question rep heading text-value-pairs)</code><code>(make-single-choice-question rep heading text-value-pairs required?)</code><code>(make-single-choice-question rep heading wording text-value-pairs required? qid)</code></div><div class="doc"><div class="markdown"><p>Creates a single choice question. <code>heading</code>, <code>wording</code> and <code>qid</code> are strings. <code>required?</code> is a boolean. <code>text-value-pairs</code> is a 2d vectors with each row consists of its text and the corresponding value. The text is a string, whereas the value is a integer. e.g., <code>[["text1" 0] ["text2" 1] ["text3" 2]]</code> represents 3 choices.</p>
<p><code>:required</code> has default value <code>true</code> if not specified. <code>wording</code> has defualt value to be the same as <code>heading</code>, if <code>wording</code> is not specified or is <code>nil</code>. We recommend users not to specify <code>qid</code>, the system will generate a unique <code>qid</code> and it can be accessed in the returned question map. Please only specify it if you know what you are doing, and make sure the assigned <code>qid</code> is unique in the entire release.</p></div></div></div><div class="public anchor" id="var-match"><h3>match</h3><div class="usage"><code>(match rep pattern)</code><code>(match rep pattern input-text)</code></div><div class="doc"><div class="markdown"><p>Test if the current user input matches the <code>pattern</code>, which is a quoted vector of match pattern. All namespaces in the given pattern need to be fully qualified unless the alias is defined in the same script. <strong>Example</strong></p>
<pre><code>(match '[hello])
</code></pre></div></div></div><div class="public anchor" id="var-match-stashed"><h3>match-stashed</h3><div class="usage"><code>(match-stashed rep pattern)</code></div><div class="doc"><div class="markdown"><p>Test if the stashed user input matches the <code>pattern</code>, which is a quoted vector of match pattern. <strong>Example</strong></p>
<pre><code>(match-stashed '[hello])
</code></pre></div></div></div><div class="public anchor" id="var-multiple-choice-answer-values"><h3>multiple-choice-answer-values</h3><div class="usage"><code>(multiple-choice-answer-values rep qn)</code></div><div class="doc"><div class="markdown"><p>Retrieve multiple choice answer values as a set.</p></div></div></div><div class="public anchor" id="var-outbound-redirect-url"><h3>outbound-redirect-url</h3><div class="usage"><code>(outbound-redirect-url rep target-url)</code><code>(outbound-redirect-url rep target-url third-party-map)</code></div><div class="doc"><div class="markdown"><p>Return a URL that will redirect to the target URL. An optional map can be used to add any third-party codes and values that will be stored in the participation results.</p></div></div></div><div class="public anchor" id="var-parse-number"><h3>parse-number</h3><div class="usage"><code>(parse-number _ text)</code></div><div class="doc"><div class="markdown"><p>Return nil if the text does not represent a number.</p></div></div></div><div class="public anchor" id="var-post-chat-url"><h3>post-chat-url</h3><div class="usage"><code>(post-chat-url rep)</code></div><div class="doc"><div class="markdown"><p>Return Juji’s post chat url.</p></div></div></div><div class="public anchor" id="var-pow"><h3>pow</h3><div class="usage"><code>(pow base exponent)</code></div><div class="doc"><div class="markdown"><p>Power function</p></div></div></div><div class="public anchor" id="var-question-answered.3F"><h3>question-answered?</h3><div class="usage"><code>(question-answered? rep qn)</code></div><div class="doc"><div class="markdown"><p>Check if the question <code>qn</code> has any answer stored for the most recent time it was asked. Return the time of the answer if answered, otherwise, return <code>nil</code>.</p></div></div></div><div class="public anchor" id="var-question-asked.3F"><h3>question-asked?</h3><div class="usage"><code>(question-asked? rep question)</code></div><div class="doc"><div class="markdown"><p>Check whether the question has been asked.</p></div></div></div><div class="public anchor" id="var-question-has-paraphrase.3F"><h3>question-has-paraphrase?</h3><div class="usage"><code>(question-has-paraphrase? rep question)</code></div><div class="doc"><div class="markdown"><p>Check whether question has any paraphrase.</p></div></div></div><div class="public anchor" id="var-question-response-failed.3F"><h3>question-response-failed?</h3><div class="usage"><code>(question-response-failed? rep question)</code></div><div class="doc"><div class="markdown"><p>Return true if the question’s response is believed to be a failure. Usually used together with <code>set-question-response-failed</code>.</p></div></div></div><div class="public anchor" id="var-random-code"><h3>random-code</h3><div class="usage"><code>(random-code _ len)</code></div><div class="doc"><div class="markdown"><p>Generate alphanumeric code of given length.</p></div></div></div><div class="public anchor" id="var-random-number-string"><h3>random-number-string</h3><div class="usage"><code>(random-number-string _ len)</code></div><div class="doc"><div class="markdown"><p>Generate number string of given length</p></div></div></div><div class="public anchor" id="var-record-one-move-message"><h3>record-one-move-message</h3><div class="usage"><code>(record-one-move-message rep {:keys [value text question], :as move})</code></div><div class="doc"><div class="markdown"><p>Record a single move message. A move message should include the following fields: :type, :gid, :question, :value, :text.</p></div></div></div><div class="public anchor" id="var-remaining-agenda-question-count"><h3>remaining-agenda-question-count</h3><div class="usage"><code>(remaining-agenda-question-count rep)</code></div><div class="doc"><div class="markdown"><p>Check the number of questions remain in the agenda.</p></div></div></div><div class="public anchor" id="var-remaining-agenda-size"><h3>remaining-agenda-size</h3><div class="usage"><code>(remaining-agenda-size rep)</code></div><div class="doc"><div class="markdown"><p>Check the remaining agenda size (i.e., how many topics left on the agenda)</p></div></div></div><div class="public anchor" id="var-required.3F"><h3>required?</h3><div class="usage"><code>(required? rep question)</code></div><div class="doc"><div class="markdown"><p>Check if the question is required. Return a boolean. If the <code>:required</code> field is not set, default to <code>true</code>.</p></div></div></div><div class="public anchor" id="var-reset-followup-conditions"><h3>reset-followup-conditions</h3><div class="usage"><code>(reset-followup-conditions rep)</code></div><div class="doc"><div class="markdown"><p>Reset all followup and extended reply conditions. So previous chat does not trigger any followup and extended replies. Nevertheless, attributes remains.</p></div></div></div><div class="public anchor" id="var-return-to-question"><h3>return-to-question</h3><div class="usage"><code>(return-to-question rep question)</code></div><div class="doc"><div class="markdown"><p>Return to the first appearance of the given question in agenda.</p></div></div></div><div class="public anchor" id="var-set-question-min-input-len"><h3>set-question-min-input-len</h3><div class="usage"><code>(set-question-min-input-len rep question threshold)</code></div><div class="doc"><div class="markdown"><p>Set <code>:min-input-len</code> value in the given <code>question</code> map. The value need to be an integer.</p></div></div></div><div class="public anchor" id="var-set-question-response-failed"><h3>set-question-response-failed</h3><div class="usage"><code>(set-question-response-failed rep question bool)</code></div><div class="doc"><div class="markdown"><p>Set a boolean value to record whether the question response is considered a failure. Usually used together with <code>question-response-failed?</code>.</p></div></div></div><div class="public anchor" id="var-set-timer"><h3>set-timer</h3><div class="usage"><code>(set-timer rep var-name t)</code></div><div class="doc"><div class="markdown"><p>Set a timer at the <code>var-name</code> that expires <code>t</code> seconds from now, return <code>nil</code>.</p>
<p>This function is usually used with <code>timer-expired?</code></p></div></div></div><div class="public anchor" id="var-skip-all-subtopics"><h3>skip-all-subtopics</h3><div class="usage"><code>(skip-all-subtopics rep)</code></div><div class="doc"><div class="markdown"><p>Skip all sibling followup topics.</p></div></div></div><div class="public anchor" id="var-skip-next-subtopic"><h3>skip-next-subtopic</h3><div class="usage"><code>(skip-next-subtopic rep n)</code></div><div class="doc"><div class="markdown"><p>Skip the next <code>n</code> sibling followup topics.</p></div></div></div><div class="public anchor" id="var-sleep-rep"><h3>sleep-rep</h3><div class="usage"><code>(sleep-rep rep t)</code></div><div class="doc"><div class="markdown"><p>Make the REP sleep for <code>t</code> milliseconds, return an empty string.</p></div></div></div><div class="public anchor" id="var-stash-input"><h3>stash-input</h3><div class="usage"><code>(stash-input rep)</code></div><div class="doc"><div class="markdown"><p>Save the current user input for later use, e.g. for <code>match-stashed</code> function</p></div></div></div><div class="public anchor" id="var-thin-text.3F"><h3>thin-text?</h3><div class="usage"><code>(thin-text? rep question)</code><code>(thin-text? rep question input)</code></div><div class="doc"><div class="markdown"><p>Checks if the user input is thin, i.e. not saying much. This is first check against <code>:min-input-len</code> in the question map, if that does not exsit, <code>:thin-text-threshold</code> in script is used instead. The <code>input</code> is considered thin if less than the threshold. When <code>input</code> is not given, length in calculated using <code>input-length</code></p></div></div></div><div class="public anchor" id="var-timer-expired.3F"><h3>timer-expired?</h3><div class="usage"><code>(timer-expired? rep var-name)</code></div><div class="doc"><div class="markdown"><p>Check if the timer at the given <code>var-name</code> is expired.</p>
<p>This function is usually used with <code>set-timer</code></p></div></div></div><div class="public anchor" id="var-update-ask-for-more-counter"><h3>update-ask-for-more-counter</h3><div class="usage"><code>(update-ask-for-more-counter rep question)</code></div><div class="doc"><div class="markdown"><p>Update the ask-for-more counter. Increment the counter if it exists. Otherwise, set the counter to 1 if the question exists. Usually used together with <code>ask-for-more?</code></p></div></div></div><div class="public anchor" id="var-update-last-participation-question-map"><h3>update-last-participation-question-map</h3><div class="usage"><code>(update-last-participation-question-map rep question update-map)</code></div><div class="doc"><div class="markdown"><p>Update participation question map, which is persisted throughout the participation, whereas the question argument in topic (e.g., <code>?q</code>) only persists in the scope of the topic. <code>get-last-participation-question-map</code> function can be used to retrieve info from it.</p></div></div></div><div class="public anchor" id="var-wait-for-more-user-input"><h3>wait-for-more-user-input</h3><div class="usage"><code>(wait-for-more-user-input rep)</code></div><div class="doc"><div class="markdown"><p>REP will wait for more user input, return <code>nil</code>.</p></div></div></div></div></body></html>